---
import Layout from '../layouts/Layout.astro';
---

<Layout title="El Impostor â€“ Juego Social de Roles">
  <main class="min-h-dvh bg-gradient-to-br from-gray-900 via-indigo-950 to-gray-900 flex flex-col items-center py-8 px-6 overflow-y-auto">
    
    <!-- Logo -->
    <img
      src="/logo/impostorlogo2.svg"
      alt="El Impostor â€“ Logo"
      class="w-[45vw] h-[45vw] max-w-[300px] max-h-[300px] sm:w-[35vw] sm:h-[35vw] md:w-[28vw] md:h-[28vw] lg:w-[20vw] lg:h-[20vw] mb-3 rounded-3xl drop-shadow-2xl object-contain animate-fade-in"
    />

    <!-- TÃ­tulo -->
    <h1 class="text-4xl sm:text-5xl font-black text-white tracking-tight mb-1 text-center animate-fade-in">El Impostor</h1>
    <p class="text-base sm:text-lg text-indigo-300 mb-6 text-center animate-fade-in">Â¿PodrÃ¡s descubrir quiÃ©n miente?</p>

    <!-- Botones -->
    <div class="w-full max-w-xs flex flex-col gap-3 animate-fade-in">
      <a
        href="/jugar"
        class="w-full flex items-center justify-center gap-2 bg-indigo-600 text-white font-semibold py-3.5 px-6 rounded-xl text-lg shadow-lg shadow-indigo-500/25 hover:bg-indigo-700 active:scale-95 transition-all"
      >
        ðŸš€ Jugar ahora
      </a>

      <a
        href="/jugar#como-jugar"
        id="how-to-play-btn"
        class="w-full flex items-center justify-center gap-2 bg-gray-700/60 text-white font-semibold py-3 px-6 rounded-xl text-base border border-gray-600/50 hover:bg-gray-700 active:scale-95 transition-all"
      >
        ðŸ“– CÃ³mo jugar
      </a>

      <!-- BotÃ³n instalar PWA - siempre visible, JS lo maneja -->
      <button
        id="install-btn"
        class="w-full flex items-center justify-center gap-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold py-3.5 px-6 rounded-xl text-base shadow-lg shadow-green-500/25 hover:from-green-700 hover:to-emerald-700 active:scale-95 transition-all animate-pulse"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M12 3v12m0 0l-4-4m4 4l4-4" />
        </svg>
        ðŸ“² Instalar en mi celular
      </button>

      <div id="installed-msg" class="hidden w-full flex items-center justify-center gap-2 text-green-400 text-sm py-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
        </svg>
        App instalada
      </div>
    </div>

    <!-- Info -->
    <div class="flex items-center gap-4 sm:gap-6 text-xs sm:text-sm text-gray-400 mt-6">
      <span>ðŸ“± Mobile-first</span>
      <span>ðŸ”’ Sin cuentas</span>
      <span>ðŸ“´ 100% offline</span>
    </div>

    <!-- Footer con marca -->
    <div class="mt-auto pt-6 flex flex-col items-center">
      <a
        href="https://devcraftpablo.online/"
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center gap-2.5 bg-white/5 border border-white/10 rounded-full py-2 px-4 hover:bg-white/10 hover:border-indigo-500/30 transition-all group"
      >
        <img
          src="/logo/devcraft-logo.png"
          alt="DevCraft"
          class="w-6 h-6 rounded-full object-cover ring-1 ring-white/20 group-hover:ring-indigo-400/50 transition-all"
        />
        <span class="text-xs text-gray-300 group-hover:text-white transition-colors">
          MÃ¡s proyectos en <span class="font-semibold text-indigo-400 group-hover:text-indigo-300">devcraftpablo.online</span>
        </span>
      </a>
    </div>

    <!-- GuÃ­a instalaciÃ³n iOS -->
    <div id="ios-guide" class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-6 hidden">
      <div class="bg-gray-800 rounded-2xl p-6 max-w-sm w-full text-center">
        <h3 class="text-lg font-bold text-white mb-4">Instalar en iPhone/iPad</h3>
        <div class="flex flex-col gap-4 text-left text-sm text-gray-300">
          <div class="flex items-start gap-3">
            <span class="bg-indigo-600 text-white w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">1</span>
            <p>TocÃ¡ el botÃ³n <strong class="text-white">Compartir</strong> (el Ã­cono con la flecha hacia arriba â†‘) en la barra de Safari</p>
          </div>
          <div class="flex items-start gap-3">
            <span class="bg-indigo-600 text-white w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">2</span>
            <p>BuscÃ¡ y tocÃ¡ <strong class="text-white">"Agregar a pantalla de inicio"</strong></p>
          </div>
          <div class="flex items-start gap-3">
            <span class="bg-indigo-600 text-white w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">3</span>
            <p>TocÃ¡ <strong class="text-white">"Agregar"</strong> y Â¡listo! La app aparecerÃ¡ en tu pantalla de inicio.</p>
          </div>
        </div>
        <button
          id="ios-guide-close"
          class="mt-6 w-full bg-indigo-600 text-white font-semibold py-3 rounded-xl active:scale-95 transition-all"
        >
          Â¡Entendido!
        </button>
      </div>
    </div>
  </main>
</Layout>

<script>
  let deferredPrompt: any = null;
  const installBtn = document.getElementById('install-btn');
  const installedMsg = document.getElementById('installed-msg');

  const isStandalone =
    window.matchMedia('(display-mode: standalone)').matches ||
    (navigator as any).standalone === true;

  const ua = navigator.userAgent;
  const isIOS = /iPad|iPhone|iPod/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);

  // Si ya estÃ¡ instalada, ocultar botÃ³n y mostrar mensaje
  if (isStandalone) {
    if (installBtn) installBtn.style.display = 'none';
    if (installedMsg) installedMsg.classList.remove('hidden');
  }

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
  });

  installBtn?.addEventListener('click', async () => {
    if (isIOS) {
      const guide = document.getElementById('ios-guide');
      if (guide) guide.classList.remove('hidden');
      return;
    }

    if (deferredPrompt) {
      try {
        await deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          if (installBtn) installBtn.style.display = 'none';
          if (installedMsg) installedMsg.classList.remove('hidden');
        }
      } catch {}
      deferredPrompt = null;
    } else {
      // Fallback: si no hay prompt nativo, mostrar guÃ­a manual
      const guide = document.getElementById('ios-guide');
      if (guide) {
        const title = guide.querySelector('h3');
        if (title) title.textContent = 'CÃ³mo instalar la app';
        guide.querySelector('p:first-of-type')!.innerHTML =
          'En <strong class="text-white">Chrome</strong>: tocÃ¡ los 3 puntos (â‹®) arriba a la derecha';
        guide.querySelectorAll('p')[1]!.innerHTML =
          'BuscÃ¡ y tocÃ¡ <strong class="text-white">"Instalar app"</strong> o <strong class="text-white">"Agregar a pantalla de inicio"</strong>';
        guide.classList.remove('hidden');
      }
    }
  });

  // Cerrar guÃ­a
  document.getElementById('ios-guide-close')?.addEventListener('click', () => {
    document.getElementById('ios-guide')?.classList.add('hidden');
  });
  document.getElementById('ios-guide')?.addEventListener('click', (e) => {
    if (e.target === e.currentTarget) {
      (e.currentTarget as HTMLElement).classList.add('hidden');
    }
  });

  window.addEventListener('appinstalled', () => {
    if (installBtn) installBtn.style.display = 'none';
    if (installedMsg) installedMsg.classList.remove('hidden');
  });
</script>
