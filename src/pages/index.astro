---
import Layout from '../layouts/Layout.astro';
---

<Layout title="El Impostor â€“ Juego Social de Roles">
  <main class="min-h-dvh bg-gradient-to-br from-gray-900 via-indigo-950 to-gray-900 flex flex-col items-center justify-start gap-6 py-8 px-6 overflow-y-auto">
    <div class="text-center animate-fade-in flex flex-col items-center flex-shrink-0">
      <img
        src="/logo/impostorlogo2.svg"
        alt="El Impostor â€“ Logo"
        class="w-[45vw] h-[45vw] max-w-[350px] max-h-[350px] sm:w-[40vw] sm:h-[40vw] md:w-[35vw] md:h-[35vw] lg:w-[25vw] lg:h-[25vw] mx-auto mb-4 rounded-3xl drop-shadow-2xl object-contain"
      />
      <h1 class="text-4xl sm:text-5xl font-black text-white tracking-tight mb-2">El Impostor</h1>
      <p class="text-base sm:text-lg text-indigo-300 mb-8">Â¿PodrÃ¡s descubrir quiÃ©n miente?</p>

      <a
        href="/jugar"
        class="inline-flex items-center gap-2 bg-indigo-600 text-white font-semibold px-8 py-4 rounded-xl text-lg shadow-lg shadow-indigo-500/25 hover:bg-indigo-700 active:scale-95 transition-all"
      >
        ðŸš€ Jugar ahora
      </a>

      <!-- BotÃ³n instalar PWA -->
      <div id="install-container" class="mt-4 hidden">
        <button
          id="install-btn"
          class="inline-flex items-center gap-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-bold px-8 py-4 rounded-xl text-base shadow-lg shadow-green-500/25 hover:from-green-700 hover:to-emerald-700 active:scale-95 transition-all animate-pulse"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M12 3v12m0 0l-4-4m4 4l4-4" />
          </svg>
          ðŸ“² Instalar en mi celular
        </button>
      </div>

      <div id="installed-msg" class="mt-4 hidden">
        <span class="inline-flex items-center gap-2 text-green-400 text-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
          </svg>
          App instalada
        </span>
      </div>

      <div class="mt-6 flex flex-col gap-3 items-center">
        <div class="flex items-center gap-4 sm:gap-6 text-xs sm:text-sm text-gray-400">
          <span>ðŸ“± Mobile-first</span>
          <span>ðŸ”’ Sin cuentas</span>
          <span>ðŸ“´ 100% offline</span>
        </div>
      </div>
    </div>

    <!-- Footer con marca -->
    <div class="flex flex-col items-center gap-3 pt-2 flex-shrink-0">
      <a
        href="https://devcraftpablo.online/"
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center gap-2.5 bg-white/5 border border-white/10 rounded-full py-2 px-4 hover:bg-white/10 hover:border-indigo-500/30 transition-all group"
      >
        <img
          src="/logo/devcraft-logo.png"
          alt="DevCraft"
          class="w-6 h-6 rounded-full object-cover ring-1 ring-white/20 group-hover:ring-indigo-400/50 transition-all"
        />
        <span class="text-xs text-gray-300 group-hover:text-white transition-colors">
          MÃ¡s proyectos en <span class="font-semibold text-indigo-400 group-hover:text-indigo-300">devcraftpablo.online</span>
        </span>
      </a>
    </div>

    <!-- GuÃ­a instalaciÃ³n iOS -->
    <div id="ios-guide" class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-6 hidden">
      <div class="bg-gray-800 rounded-2xl p-6 max-w-sm w-full text-center">
        <h3 class="text-lg font-bold text-white mb-4">Instalar en iPhone/iPad</h3>
        <div class="flex flex-col gap-4 text-left text-sm text-gray-300">
          <div class="flex items-start gap-3">
            <span class="bg-indigo-600 text-white w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">1</span>
            <p>TocÃ¡ el botÃ³n <strong class="text-white">Compartir</strong> (el Ã­cono con la flecha hacia arriba â†‘) en la barra de Safari</p>
          </div>
          <div class="flex items-start gap-3">
            <span class="bg-indigo-600 text-white w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">2</span>
            <p>BuscÃ¡ y tocÃ¡ <strong class="text-white">"Agregar a pantalla de inicio"</strong></p>
          </div>
          <div class="flex items-start gap-3">
            <span class="bg-indigo-600 text-white w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0">3</span>
            <p>TocÃ¡ <strong class="text-white">"Agregar"</strong> y Â¡listo! La app aparecerÃ¡ en tu pantalla de inicio.</p>
          </div>
        </div>
        <button
          id="ios-guide-close"
          class="mt-6 w-full bg-indigo-600 text-white font-semibold py-3 rounded-xl active:scale-95 transition-all"
        >
          Â¡Entendido!
        </button>
      </div>
    </div>
  </main>
</Layout>

<script>
  let deferredPrompt: any = null;

  const isStandalone =
    window.matchMedia('(display-mode: standalone)').matches ||
    (navigator as any).standalone === true;

  const ua = navigator.userAgent;
  const isIOS = /iPad|iPhone|iPod/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);

  if (isStandalone) {
    const msg = document.getElementById('installed-msg');
    if (msg) msg.classList.remove('hidden');
  } else if (isIOS) {
    // En iOS no hay beforeinstallprompt, mostrar botÃ³n siempre
    const container = document.getElementById('install-container');
    if (container) container.classList.remove('hidden');
  }

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    const container = document.getElementById('install-container');
    if (container) container.classList.remove('hidden');
  });

  document.getElementById('install-btn')?.addEventListener('click', async () => {
    if (isIOS) {
      // Mostrar guÃ­a iOS
      const guide = document.getElementById('ios-guide');
      if (guide) guide.classList.remove('hidden');
      return;
    }

    if (!deferredPrompt) return;
    const btn = document.getElementById('install-btn') as HTMLButtonElement;
    btn.textContent = 'Instalando...';
    btn.disabled = true;
    try {
      await deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === 'accepted') {
        const container = document.getElementById('install-container');
        const msg = document.getElementById('installed-msg');
        if (container) container.classList.add('hidden');
        if (msg) msg.classList.remove('hidden');
      }
    } catch {}
    deferredPrompt = null;
  });

  // Cerrar guÃ­a iOS
  document.getElementById('ios-guide-close')?.addEventListener('click', () => {
    const guide = document.getElementById('ios-guide');
    if (guide) guide.classList.add('hidden');
  });
  document.getElementById('ios-guide')?.addEventListener('click', (e) => {
    if (e.target === e.currentTarget) {
      const guide = document.getElementById('ios-guide');
      if (guide) guide.classList.add('hidden');
    }
  });

  window.addEventListener('appinstalled', () => {
    const container = document.getElementById('install-container');
    const msg = document.getElementById('installed-msg');
    if (container) container.classList.add('hidden');
    if (msg) msg.classList.remove('hidden');
  });
</script>
